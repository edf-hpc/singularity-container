Description: Make the build reproducible
Author: Chris Lamb <lamby@debian.org>
Last-Update: 2017-06-27

--- singularity-container-2.3.orig/libexec/bootstrap-scripts/environment/Makefile.am
+++ singularity-container-2.3/libexec/bootstrap-scripts/environment/Makefile.am
@@ -39,7 +39,7 @@ environment.tar:
 	ln -sf .singularity.d/actions/run newroot/.run
 	ln -sf .singularity.d/actions/shell newroot/.shell
 	ln -sf .singularity.d/actions/test newroot/.shell
-	cd newroot; tar czf ../environment.tar . --owner=0 --group=0
+	cd newroot; GZIP=-n tar czf ../environment.tar . --owner=0 --group=0 --sort=name --mtime="@${SOURCE_DATE_EPOCH:-$(date +%s)}" 
 	rm -rf newroot
 
 MAINTAINERCLEANFILES = Makefile.in
Description: Make the build reproducible
Author: Chris Lamb <lamby@debian.org>
Last-Update: 2017-06-27

--- singularity-container-2.3.orig/libexec/bootstrap-scripts/environment/Makefile.am
+++ singularity-container-2.3/libexec/bootstrap-scripts/environment/Makefile.am
@@ -39,7 +39,7 @@ environment.tar:
 	ln -sf .singularity.d/actions/run newroot/.run
 	ln -sf .singularity.d/actions/shell newroot/.shell
 	ln -sf .singularity.d/actions/test newroot/.shell
-	cd newroot; tar czf ../environment.tar . --owner=0 --group=0
+	cd newroot; GZIP=-n tar czf ../environment.tar . --owner=0 --group=0 --sort=name --mtime="@${SOURCE_DATE_EPOCH:-$(date +%s)}" 
 	rm -rf newroot
 
 MAINTAINERCLEANFILES = Makefile.in
